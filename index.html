<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>个人简历</title>
  
  <!-- Favicon -->
  <link rel="icon" href="favicon.ico">
  <link rel="shortcut icon" href="favicon.ico">
  <!-- 引入marked库 -->
  <script src="https://unpkg.com/marked@4.3.0/marked.min.js"></script>
  <!-- 引入html2pdf库 -->
  <script src="https://unpkg.com/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>
  <!-- 引入jsPDF库作为备选 -->
  <script src="https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      line-height: 1.6;
      color: #1e293b;
      background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);
      min-height: 100vh;
      padding: 12px;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
      overflow: hidden;
      position: relative;
    }

    .action-buttons {
      position: absolute;
      top: 15px;
      right: 15px;
      display: flex;
      gap: 8px;
      z-index: 10;
    }

    .action-btn {
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid rgba(59, 130, 246, 0.2);
      color: #3b82f6;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 5px;
      backdrop-filter: blur(10px);
    }

    .action-btn:hover {
      background: rgba(59, 130, 246, 0.2);
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2);
    }

    .action-btn:active {
      transform: translateY(0);
    }

    .action-btn svg {
      width: 16px;
      height: 16px;
      fill: currentColor;
    }

    .content {
      padding: 30px 25px;
    }

    /* Markdown样式优化 */
    .markdown-content h1 {
      font-size: 1.4em;
      color: #0f172a;
      margin-bottom: 12px;
      font-weight: 600;
    }

    .markdown-content h2 {
      font-size: 1.15em;
      color: #1e40af;
      margin-top: 18px;
      margin-bottom: 12px;
      font-weight: 600;
      position: relative;
      padding-bottom: 4px;
    }

    .markdown-content h2::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 30px;
      height: 1.5px;
      background: #3b82f6;
      border-radius: 1px;
    }

    .markdown-content h3 {
      font-size: 1em;
      color: #334155;
      margin-top: 15px;
      margin-bottom: 10px;
      font-weight: 600;
    }

    /* 统一列表样式 */
    .markdown-content ul {
      list-style: none;
      padding-left: 0;
      margin: 12px 0;
    }

    .markdown-content li {
      margin-bottom: 6px;
      position: relative;
      padding-left: 18px;
      line-height: 1.5;
    }

    .markdown-content li::before {
      content: "•";
      color: #3b82f6;
      font-weight: bold;
      position: absolute;
      left: 0;
      top: 0;
    }

    /* 确保嵌套列表也能正确显示 */
    .markdown-content ul ul {
      list-style: none;
      padding-left: 0;
      margin: 6px 0;
    }

    .markdown-content ul ul li {
      margin-bottom: 5px;
      position: relative;
      padding-left: 18px;
      line-height: 1.4;
      background: transparent !important;
      border: none !important;
      box-shadow: none !important;
      padding: 0 0 0 18px !important;
    }

    .markdown-content ul ul li::before {
      content: "•";
      color: #3b82f6;
      font-weight: bold;
      position: absolute;
      left: 0;
      top: 0;
    }

    .markdown-content strong {
      color: #0f172a;
      font-weight: 600;
    }

    .markdown-content p {
      margin-bottom: 12px;
      line-height: 1.6;
      color: #334155;
    }

    .markdown-content hr {
      border: none;
      border-top: 1px solid #cbd5e1;
      margin: 20px 0;
    }

    /* 响应式设计优化 */
    @media (max-width: 1000px) {
      .container {
        max-width: 95%;
      }


    }

    @media (max-width: 768px) {
      body {
        padding: 10px;
      }

      .container {
        border-radius: 6px;
        max-width: 100%;
      }

      .action-buttons {
        top: 12px;
        right: 12px;
        gap: 6px;
      }

      .action-btn {
        padding: 5px 8px;
        font-size: 12px;
      }

      .content {
        padding: 25px 20px;
      }

      .markdown-content h1 {
        font-size: 1.4em;
      }

      .markdown-content h2 {
        font-size: 1.15em;
      }


    }

    @media (max-width: 480px) {
      body {
        padding: 6px;
      }

      .container {
        border-radius: 4px;
      }

      .content {
        padding: 20px 15px;
      }

      .action-buttons {
        top: 8px;
        right: 8px;
        gap: 4px;
      }

      .action-btn {
        padding: 4px 6px;
        font-size: 11px;
      }

      .markdown-content h1 {
        font-size: 1.2em;
      }

      .markdown-content h2 {
        font-size: 1em;
      }


    }

    /* 加载状态 */
    .loading {
      text-align: center;
      padding: 40px;
      color: #3b82f6;
    }

    .loading::after {
      content: '';
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid #93c5fd;
      border-radius: 50%;
      border-top-color: transparent;
      animation: spin 1s linear infinite;
      margin-left: 10px;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* 打印样式优化 */
    @media print {
      body {
        background: white !important;
        padding: 0 !important;
      }

      .container {
        box-shadow: none !important;
        border-radius: 0 !important;
        max-width: 100% !important;
      }

      .action-buttons {
        display: none !important;
      }

      .content {
        padding: 20px !important;
      }

      .markdown-content h2:first-of-type+ul {
        grid-template-columns: 1fr !important;
        gap: 10px !important;
      }

      .markdown-content h2:first-of-type+ul li {
        break-inside: avoid;
        page-break-inside: avoid;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="action-buttons" style="display: none;">
      <button class="action-btn" onclick="refreshContent()" title="刷新内容">
        <svg viewBox="0 0 24 24">
          <path
            d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z" />
        </svg>
        刷新
      </button>
      <button class="action-btn" onclick="exportToPDF()" title="导出PDF">
        <svg viewBox="0 0 24 24">
          <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z" />
        </svg>
        下载
      </button>
    </div>

    <div class="content">
      <div class="markdown-content" id="resume-content">
        <div class="loading">正在加载简历内容...</div>
      </div>
    </div>
  </div>

  <script>

    // 配置marked选项
    marked.setOptions({
      breaks: true,  // 支持换行
      gfm: true,     // 支持GitHub风格的Markdown
    });

    // 从外部markdown文件加载内容
    async function loadMarkdownFromFile() {
      try {
        const response = await fetch('resume.md');
 
        if (response.ok) {
          const content = await response.text();
          console.log('成功加载resume.md，内容长度:', content.length);
          await renderResume(content);
        } else {
          console.warn('无法加载resume.md文件，状态码:', response.status);
          showResumeNotFound();
        }
      } catch (error) {
        console.error('加载resume.md文件失败:', error);
        showResumeNotFound();
      }
    }

    // 显示简历不存在错误
    function showResumeNotFound() {
      document.getElementById('resume-content').innerHTML = `
                <div style="text-align: center; padding: 60px 20px; color: #6b7280;">
                    <svg style="width: 64px; height: 64px; margin: 0 auto 20px; color: #d1d5db;" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    <h2 style="margin-bottom: 16px; color: #374151;">简历不存在</h2>
                    <p style="margin-bottom: 8px; line-height: 1.6;">无法找到 resume.md 文件</p>
                    <p style="margin-bottom: 24px; line-height: 1.6; color: #9ca3af;">请确保文件存在于同一目录下</p>
                    <button onclick="loadMarkdownFromFile()" style="
                        background: #3b82f6; color: white; border: none; padding: 12px 24px; 
                        border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500;
                        transition: background-color 0.2s;
                    " onmouseover="this.style.background='#2563eb'" onmouseout="this.style.background='#3b82f6'">
                        重新加载
                    </button>
                </div>
            `;
    }

    // 显示内容错误
    function showContentError() {
      document.getElementById('resume-content').innerHTML = `
                <div style="text-align: center; padding: 60px 20px; color: #ef4444;">
                    <svg style="width: 64px; height: 64px; margin: 0 auto 20px; color: #ef4444;" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    <h2 style="margin-bottom: 16px; color: #dc2626;">内容加载异常</h2>
                    <p style="margin-bottom: 8px; line-height: 1.6;">resume.md文件内容不完整或格式异常</p>
                    <p style="margin-bottom: 24px; line-height: 1.6; color: #9ca3af;">请检查文件内容或重新加载</p>
                    <button onclick="loadMarkdownFromFile()" style="
                        background: #3b82f6; color: white; border: none; padding: 12px 24px; 
                        border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500;
                        transition: background-color 0.2s;
                    " onmouseover="this.style.background='#2563eb'" onmouseout="this.style.background='#3b82f6'">
                        重新加载
                    </button>
                </div>
            `;
    }

    // 渲染简历内容
    async function renderResume(markdownContent) {
      try {
        console.log('开始渲染简历内容...');
        const html = marked.parse(markdownContent);
        if (location.search.includes('lang=en')) {
          // 替换html的非标签内容为英文
          const translatedHtml = await translateHtmlContent(html)
          document.getElementById('resume-content').innerHTML = translatedHtml;
          return
        }
        document.getElementById('resume-content').innerHTML = html;
        console.log('简历内容已成功渲染到页面');

        // 验证渲染后的内容
        const renderedContent = document.getElementById('resume-content');
      } catch (error) {
        console.error('解析markdown时出错:', error);
        document.getElementById('resume-content').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #ef4444;">
                        <h2>渲染错误</h2>
                        <p>解析简历内容时出错: ${error.message}</p>
                        <p>请检查控制台获取更多信息。</p>
                        <button onclick="loadMarkdownFromFile()" style="
                            background: #3b82f6; color: white; border: none; padding: 10px 20px; 
                            border-radius: 6px; cursor: pointer; margin-top: 20px;
                        ">重新加载</button>
                    </div>
                `;
      }
    }

    // 刷新内容
    function refreshContent() {
      document.getElementById('resume-content').innerHTML = '';
      loadMarkdownFromFile();
    }
    
    // 导出PDF
    function exportToPDF() {
      const element = document.getElementById('resume-content');
 
      // 检查是否有内容
      if (!element.innerHTML || element.innerHTML.trim() === '') {
        alert('请等待内容加载完成后再导出PDF');
        return;
      }
 
      // 检查内容是否包含实际简历内容
      const textContent = element.textContent || element.innerText || '';
      if (textContent.trim().length < 50) {
        alert('简历内容为空或过少，无法导出PDF');
        return;
      }
      
      try {
        // 使用最基本的配置，确保内容完整
        const opt = {
          margin: 0.4,
          filename: '个人简历.pdf',
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: { scale: 2 },
          jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
        };
 
        html2pdf().set(opt).from(element).save()
          .then(() => {
            console.log('PDF导出成功');
          })
          .catch((error) => {
            console.error('PDF导出失败:', error);
            alert('PDF导出失败: ' + error.message);
          });
 
      } catch (error) {
        console.error('PDF导出出错:', error);
        alert('PDF导出失败: ' + error.message);
      }
    }

    async function translateContent(content) {
      const translator = await window.Translator.create({
        sourceLanguage: 'zh',
        targetLanguage: 'en',
      })
      const translatedContent = await translator.translate(content)
      return translatedContent
    }

    const pureTextRegex = /(?<=>)([^<]+?)(?=<)/g;
    async function translateHtmlContent(html) {
      const matches = Array.from(html.matchAll(pureTextRegex));
      console.log(html, 'matches')
      const translatedMap = new Map()
      for (const match of matches) {
        const [p1] = match
        if (!translatedMap.has(p1)) {
          const translated = await translateContent(p1)
          translatedMap.set(p1, translated)
        }
      }
      return html.replaceAll(pureTextRegex, (str, p1) => {
        return str.replace(p1, translatedMap.get(p1) || p1)
      })
    }

    // 页面加载完成后执行
    document.addEventListener('DOMContentLoaded', loadMarkdownFromFile);
    
    // 控制按钮显隐的方法
    function toggleButtons(show = true) {
      const actionButtons = document.querySelector('.action-buttons');
      if (actionButtons) {
        actionButtons.style.display = show ? 'flex' : 'none';
      }
    }
  </script>
</body>

</html>